"use client";
import React, { useEffect, useState } from "react";
import { motion } from "framer-motion";
import { Badge } from "./ui/badge";

const iconWrapperVariants = {
  initial: { scale: 0 },
  animate: { scale: 1 },
};

const navItems = [
  {
    id: "home",
    label: "home",
    delay: 1,
    svg: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 576 512"
        className="group-hover:scale-110 transition-all duration-300 ease-in-out size-7 dark:text-foreground/90 scale-90 sm:scale-100"
      >
        <path
          fill="currentColor"
          d="M575.8 255.5c0 18-15 32.1-32 32.1l-32 0 .7 160.2c0 2.7-.2 5.4-.5 8.1l0 16.2c0 22.1-17.9 40-40 40l-16 0c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1L416 512l-24 0c-22.1 0-40-17.9-40-40l0-24 0-64c0-17.7-14.3-32-32-32l-64 0c-17.7 0-32 14.3-32 32l0 64 0 24c0 22.1-17.9 40-40 40l-24 0-31.9 0c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2l-16 0c-22.1 0-40-17.9-40-40l0-112c0-.9 0-1.9 .1-2.8l0-69.7-32 0c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"
        />
      </svg>
    ),
  },
  {
    id: "about",
    label: "about",
    delay: 1.2,
    svg: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 576 512"
        className="group-hover:scale-110 transition-all duration-300 ease-in-out size-7 dark:text-foreground/90 scale-90 sm:scale-100"
      >
        <path
          fill="currentColor"
          d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l448 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zm80 256l64 0c44.2 0 80 35.8 80 80c0 8.8-7.2 16-16 16L80 384c-8.8 0-16-7.2-16-16c0-44.2 35.8-80 80-80zm-32-96a64 64 0 1 1 128 0 64 64 0 1 1 -128 0zm256-32l128 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-128 0c-8.8 0-16-7.2-16-16s7.2-16 16-16zm0 64l128 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-128 0c-8.8 0-16-7.2-16-16s7.2-16 16-16zm0 64l128 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-128 0c-8.8 0-16-7.2-16-16s7.2-16 16-16z"
        />
      </svg>
    ),
  },
  {
    id: "projects",
    label: "projects",
    delay: 1.4,
    svg: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 576 512"
        className="group-hover:scale-110 transition-all duration-300 ease-in-out size-7 dark:text-foreground/90 scale-90 sm:scale-100"
      >
        <path
          fill="currentColor"
          d="M384 480l48 0c11.4 0 21.9-6 27.6-15.9l112-192c5.8-9.9 5.8-22.1 .1-32.1S555.5 224 544 224l-400 0c-11.4 0-21.9 6-27.6 15.9L48 357.1 48 96c0-8.8 7.2-16 16-16l117.5 0c4.2 0 8.3 1.7 11.3 4.7l26.5 26.5c21 21 49.5 32.8 79.2 32.8L416 144c8.8 0 16 7.2 16 16l0 32 48 0 0-32c0-35.3-28.7-64-64-64L298.5 96c-17 0-33.3-6.7-45.3-18.7L226.7 50.7c-12-12-28.3-18.7-45.3-18.7L64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l23.7 0L384 480z"
        />
      </svg>
    ),
  },
  {
    id: "skills",
    label: "skills",
    delay: 1.6,
    svg: (
      <svg
        version="1.1"
        id="_x32_"
        xmlns="http://www.w3.org/2000/svg"
        xmlnsXlink="http://www.w3.org/1999/xlink"
        viewBox="0 0 512 512"
        xmlSpace="preserve"
        fill="currentColor"
        className="group-hover:scale-110 transition-all duration-300 ease-in-out size-7 dark:text-foreground/90 scale-90 sm:scale-100"
      >
        <g id="SVGRepo_bgCarrier" strokeWidth="0"></g>
        <g
          id="SVGRepo_tracerCarrier"
          strokeLinecap="round"
          strokeLinejoin="round"
        ></g>
        <g id="SVGRepo_iconCarrier">
          {" "}
          <style type="text/css"> </style>{" "}
          <g>
            {" "}
            <path
              className="st0"
              d="M475.619,295.498l-41.406-87.766c0.109-2.625,0.203-5.266,0.203-7.906 c0-110.359-89.469-199.828-199.828-199.828S34.744,89.467,34.744,199.826c0,62.063,28.297,117.5,72.672,154.156v70.641 c0,6.891,4.125,13.125,10.453,15.797l165.516,70.219c5.281,2.25,11.359,1.688,16.172-1.484c4.797-3.188,7.688-8.563,7.688-14.313 v-59.844c0-9.484,7.688-17.172,17.172-17.172h84.75c9.484,0,17.156-7.703,17.156-17.172v-51.609c0-6.563,3.766-12.563,9.672-15.438 l31.594-15.344C476.041,314.154,479.619,303.998,475.619,295.498z M234.588,335.717c-75.047,0-135.891-60.828-135.891-135.891 c0-75.047,60.844-135.875,135.891-135.875s135.875,60.828,135.875,135.875C370.463,274.889,309.635,335.717,234.588,335.717z"
            ></path>{" "}
            <path
              className="st0"
              d="M330.432,216.623c3.672-0.281,6.484-3.328,6.484-7.016v-16.766c0-3.688-2.813-6.734-6.484-7.031l-22.234-1.734 c-1.391-0.094-2.625-0.984-3.156-2.297l-7.328-17.656c-0.531-1.297-0.297-2.797,0.609-3.875l14.5-16.953 c2.391-2.781,2.234-6.938-0.375-9.531l-11.859-11.875c-2.609-2.594-6.766-2.75-9.547-0.375l-16.953,14.5 c-1.063,0.906-2.578,1.156-3.859,0.625l-17.656-7.328c-1.313-0.531-2.203-1.766-2.313-3.172l-1.719-22.219 c-0.297-3.688-3.359-6.5-7.031-6.5h-16.781c-3.672,0-6.734,2.813-7.016,6.5l-1.719,22.219c-0.109,1.406-1.016,2.641-2.328,3.172 l-17.641,7.328c-1.313,0.531-2.797,0.281-3.875-0.625l-16.953-14.5c-2.797-2.375-6.953-2.219-9.547,0.375l-11.859,11.875 c-2.594,2.594-2.766,6.75-0.375,9.531l14.5,16.953c0.906,1.078,1.156,2.578,0.609,3.875l-7.313,17.656 c-0.531,1.313-1.781,2.203-3.188,2.297l-22.234,1.734c-3.656,0.297-6.469,3.344-6.469,7.031v16.766 c0,3.688,2.813,6.734,6.469,7.016l22.234,1.734c1.406,0.109,2.656,1,3.188,2.313l7.313,17.656c0.547,1.281,0.297,2.797-0.609,3.859 l-14.5,16.969c-2.391,2.781-2.219,6.938,0.375,9.531l11.859,11.859c2.594,2.609,6.75,2.766,9.547,0.391l16.953-14.516 c1.078-0.891,2.563-1.141,3.875-0.594l17.641,7.313c1.313,0.531,2.219,1.766,2.328,3.156l1.719,22.25 c0.281,3.656,3.344,6.484,7.016,6.484h16.781c3.672,0,6.734-2.828,7.031-6.484l1.719-22.25c0.109-1.391,1-2.625,2.313-3.156 l17.656-7.313c1.281-0.547,2.797-0.297,3.859,0.594l16.953,14.516c2.781,2.375,6.938,2.219,9.547-0.391l11.859-11.859 c2.609-2.594,2.766-6.75,0.375-9.531l-14.5-16.969c-0.906-1.063-1.141-2.578-0.609-3.859l7.328-17.656 c0.531-1.313,1.766-2.203,3.156-2.313L330.432,216.623z M233.119,236.311c-9.375,0-18.188-3.656-24.813-10.281 s-10.266-15.438-10.266-24.797c0-9.375,3.641-18.188,10.266-24.813c6.625-6.641,15.438-10.281,24.813-10.281 s18.188,3.641,24.813,10.281c6.625,6.625,10.266,15.438,10.266,24.813c0,9.359-3.641,18.172-10.266,24.797 S242.494,236.311,233.119,236.311z"
            ></path>{" "}
          </g>{" "}
        </g>
      </svg>
    ),
  },
  {
    id: "timeline",
    label: "timeline",
    delay: 1.6,
    svg: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 512 512"
        className="group-hover:scale-110 transition-all duration-300 ease-in-out size-7 dark:text-foreground/90 scale-90 sm:scale-100"
      >
        <path
          fill="currentColor"
          d="M243.4 2.6l-224 96c-14 6-21.8 21-18.7 35.8S16.8 160 32 160l0 8c0 13.3 10.7 24 24 24l400 0c13.3 0 24-10.7 24-24l0-8c15.2 0 28.3-10.7 31.3-25.6s-4.8-29.9-18.7-35.8l-224-96c-8-3.4-17.2-3.4-25.2 0zM128 224l-64 0 0 196.3c-.6 .3-1.2 .7-1.8 1.1l-48 32c-11.7 7.8-17 22.4-12.9 35.9S17.9 512 32 512l448 0c14.1 0 26.5-9.2 30.6-22.7s-1.1-28.1-12.9-35.9l-48-32c-.6-.4-1.2-.7-1.8-1.1L448 224l-64 0 0 192-40 0 0-192-64 0 0 192-48 0 0-192-64 0 0 192-40 0 0-192zM256 64a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"
        />
      </svg>
    ),
  },
  {
    id: "resume",
    label: "resume",
    delay: 1.6,
    svg: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="currentColor"
        version="1.1"
        id="Layer_1"
        viewBox="0 0 491.52 491.52"
        className="group-hover:scale-110 transition-all duration-300 ease-in-out size-7 dark:text-foreground/90 scale-90 sm:scale-100"
      >
        <g>
          <g>
            <polygon points="334.879,7.93 334.879,94.307 421.256,94.307   " />
          </g>
        </g>
        <g>
          <g>
            <path d="M224.046,71.948l-14.926-5.241c-1.03-0.349-2.16-0.356-3.206,0.046c-3.228,1.223-7.51,2.818-10.204,3.677    c-2.028,0.65-4.126,0.976-6.255,0.976h-13.525c-0.73,0.177-2.049,0.623-3.369,1.668c-0.128,0.102-0.244,0.286-0.372,0.401    c-0.528,0.468-1.061,0.965-1.534,1.662c-0.591,0.872-1.113,1.936-1.483,3.244v21.577v5.21c0,0,0.643,17.783,11.451,24.937    c0.123,0.084,0.212,0.151,0.331,0.232c0.01,0.006,0.022,0.009,0.032,0.016c0.079,0.053,0.153,0.114,0.231,0.168    c1.191,0.823,2.191,1.546,3.121,2.278c6.744,5.295,11.876,7.208,13.123,7.169c0.48-0.008,0.882,0.008,1.316,0.078    c0.433,0.034,5.272,0.422,11.006-3.567c0.821-0.573,1.661-1.231,2.511-1.999c1.827-1.65,3.762-3.151,5.775-4.545    c0.061-0.038,0.634-0.441,0.697-0.48c2.789-1.879,9.641-8.257,11.234-25.382V78.351C229.767,77.351,228.629,73.636,224.046,71.948    z" />
          </g>
        </g>
        <g>
          <g>
            <polygon points="182.486,161.503 175.707,156.974 183.725,171.556 185.343,169.342 185.374,169.303 186.283,168.068     188.267,165.368   " />
          </g>
        </g>
        <g>
          <g>
            <path d="M231.121,52.818c-2.315-0.558-4.266-2.129-5.295-4.274c-1.03-2.152-1.045-4.645-0.031-6.805    c0.023-0.061,0.055-0.24,0.085-0.418c-0.17-0.015-0.488-0.116-0.983-0.24h-42.496c-11.342,0-20.593,9.143-20.764,20.446    c0.176-0.155,0.363-0.256,0.541-0.404c0.617-0.514,1.238-0.961,1.871-1.395c0.428-0.293,0.843-0.604,1.273-0.861    c0.686-0.414,1.359-0.751,2.04-1.08c0.376-0.182,0.749-0.393,1.118-0.55c0.753-0.32,1.468-0.561,2.181-0.786    c0.273-0.086,0.559-0.207,0.824-0.281c0.956-0.263,1.86-0.454,2.67-0.559c0.333-0.038,0.674-0.062,1.015-0.062h14.284    c0.488,0,0.968-0.077,1.432-0.224c2.469-0.79,6.41-2.261,9.399-3.398c1.157-0.439,2.345-0.763,3.547-0.985    c0.304-0.056,0.613-0.051,0.918-0.093c0.907-0.126,1.814-0.24,2.726-0.244c0.035,0,0.067-0.009,0.101-0.009    c0.643,0,1.279,0.101,1.919,0.161c0.485,0.045,0.972,0.041,1.454,0.121c1.156,0.192,2.299,0.478,3.417,0.872l15.035,5.28    c1.571,0.577,2.982,1.273,4.289,2.034c0.488,0.285,0.896,0.612,1.349,0.915c0.762,0.515,1.519,1.026,2.187,1.587    c0.123,0.104,0.284,0.189,0.405,0.294v-2.044C237.346,58.508,236.007,53.987,231.121,52.818z" />
          </g>
        </g>
        <g>
          <g>
            <path d="M279.741,183.091c-0.658-3.948-3.398-7.247-7.169-8.609l-33.933-12.28l-15.329,27.881c-1.3,2.376-3.723,3.918-6.426,4.095    c-0.177,0.008-0.348,0.016-0.518,0.016c-2.516,0-4.893-1.193-6.388-3.236l-10.413-14.18l-1.037,1.405    c-0.006,0.012-0.017,0.025-0.025,0.037l0.002,0.002l-0.373,0.502l0.002,0.001l-8.973,12.233c-1.502,2.044-3.879,3.236-6.395,3.236    c-0.17,0-0.341-0.008-0.518-0.016c-2.694-0.177-5.126-1.719-6.426-4.095l-15.335-27.881l-33.935,12.28    c-3.762,1.362-6.51,4.661-7.169,8.609l-4.166,25.161l0.643,0.751h167.412l0.635-0.751L279.741,183.091z" />
          </g>
        </g>
        <g>
          <g>
            <path d="M326.95,110.162c-4.382,0-7.928-3.546-7.928-7.927V0H62.335v491.52h366.849V110.162H326.95z M99.577,205.659l4.166-25.154    c1.587-9.6,8.261-17.621,17.419-20.934l40.305-14.586c0,0,0.009,0,0.014-0.002c0,0,0.006-0.004,0.009-0.005l7.131-2.553v-1.603    c-14.614-12.649-15.284-34.489-15.306-35.483v-5.013c-0.166-2.562-0.913-4.707-2.245-6.36c-3.415-4.251-5.288-9.616-5.288-15.113    V61.837c0-20.191,16.428-36.612,36.619-36.612h43.347c0.511,0,1.014,0.047,1.509,0.147c7.758,1.502,11.288,5.574,12.891,8.718    c1.061,2.098,1.509,4.188,1.602,6.116c7.858,4.715,11.04,12.968,11.675,17.937c0.038,0.333,0.062,0.666,0.062,0.999V82.29    c0,3.569-1.007,7.076-2.919,10.142c-3.615,5.791-4.792,13.2-4.8,13.277c-0.02,0.134-0.099,0.239-0.126,0.369    c-2.046,19.233-9.383,29.254-15.133,34.253v2.094l7.123,2.551l0.008,0.005c0.005,0.002,0.009,0,0.015,0.002l40.305,14.586    c9.158,3.306,15.832,11.326,17.419,20.934l4.165,25.161c0.798,4.785-0.549,9.662-3.685,13.362    c-3.143,3.709-7.726,5.83-12.588,5.83H115.859c-4.862,0-9.453-2.129-12.596-5.83C100.127,215.321,98.78,210.451,99.577,205.659z     M333.376,447.478H107.281c-4.382,0-7.928-3.546-7.928-7.928c0-4.381,3.546-7.927,7.928-7.927h226.095    c4.382,0,7.927,3.546,7.927,7.927C341.304,443.932,337.759,447.478,333.376,447.478z M384.241,405.184h-276.96    c-4.382,0-7.928-3.546-7.928-7.927c0-4.382,3.546-7.928,7.928-7.928h276.96c4.381,0,7.927,3.546,7.927,7.928    C392.168,401.638,388.622,405.184,384.241,405.184z M384.241,362.882h-276.96c-4.382,0-7.928-3.546-7.928-7.928    c0-4.381,3.546-7.927,7.928-7.927h276.96c4.381,0,7.927,3.546,7.927,7.927C392.168,359.336,388.622,362.882,384.241,362.882z     M384.241,320.588h-276.96c-4.382,0-7.928-3.546-7.928-7.927c0-4.382,3.546-7.928,7.928-7.928h276.96    c4.381,0,7.927,3.546,7.927,7.928C392.168,317.042,388.622,320.588,384.241,320.588z M384.241,278.294h-276.96    c-4.382,0-7.928-3.546-7.928-7.928s3.546-7.928,7.928-7.928h276.96c4.381,0,7.927,3.546,7.927,7.928    S388.622,278.294,384.241,278.294z" />
          </g>
        </g>
        <g>
          <g>
            <polygon points="210.861,165.37 215.405,171.564 223.418,156.978   " />
          </g>
        </g>
      </svg>
    ),
  },
];

const MobileView = ({
  scrollref,
}: {
  scrollref: React.RefObject<HTMLDivElement | null>;
}) => {
  const [activeSection, setActiveSection] = useState<string | null>(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) setActiveSection(entry.target.id);
        });
      },
      { root: null, threshold: 0.2 }
    );

    navItems.forEach(({ id }) => {
      const section = document.getElementById(id);
      if (section) observer.observe(section);
    });

    return () => observer.disconnect();
  }, []);

  const scrollToElementSlow = (target: string) => {
    if (!scrollref.current) return;
    const id = target.startsWith("#") ? target.slice(1) : target;
    const element = document.getElementById(id);
    if (!element) return;

    const container = scrollref.current;
    const containerRect = container.getBoundingClientRect();
    const elementRect = element.getBoundingClientRect();
    const targetPosition =
      elementRect.top - containerRect.top + container.scrollTop;
    const startPosition = container.scrollTop;
    const distance = targetPosition - startPosition;
    const duration = 1500;
    let startTime: number | null = null;

    const easeInOutCubic = (t: number) =>
      t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;

    const animation = (currentTime: number) => {
      if (startTime === null) startTime = currentTime;
      const timeElapsed = currentTime - startTime;
      const progress = Math.min(timeElapsed / duration, 1);
      const ease = easeInOutCubic(progress);

      container.scrollTop = startPosition + distance * ease;

      if (timeElapsed < duration) {
        requestAnimationFrame(animation);
      }
    };

    requestAnimationFrame(animation);
  };

  return (
    <div className="fixed bottom-2 sm:hidden z-50 left-1/2 -translate-x-1/2 px-3 py-2 flex items-center gap-3 rounded-full backdrop-blur-md bg-background/40 shadow-md border border-border">
      {navItems.map((item) => (
        <motion.div
          key={item.id}
          initial="initial"
          animate="animate"
          variants={iconWrapperVariants}
          transition={{ type: "spring", duration: 1, delay: item.delay }}
          className="relative flex items-center justify-center"
        >
          <button
            onClick={() => {
              scrollToElementSlow(`#${item.id}`);
              setActiveSection(item.id);
            }}
            className={`transition-transform duration-300 cursor-pointer ${
              activeSection === item.id ? "scale-125 text-primary" : ""
            }`}
          >
            {item.svg}
          </button>
          <Badge
            className={`absolute -top-8 transition-all duration-300 ease-in-out bg-foreground/70 text-background mobile-navbar-badge
    ${
      activeSection === item.id
        ? "scale-100 opacity-100"
        : "scale-0 opacity-0 pointer-events-none"
    }
    `}
            variant="outline"
          >
            {item.label}
          </Badge>
        </motion.div>
      ))}
    </div>
  );
};

export default MobileView;
